2025 10 09  
CS240  
Ken Rodham  
Handlers or smth idk

# curl

Uhhh idk what curl is but it's some command line command (I think it's WSL specifically). You can use it to run a "post" command. (Bro idk wtf any of this is talking about oh nooooo.)

# Javalin

We'll use Javalin for handlers or smth like that.

Take in a `Context` object. (Whatever that is.)

# Handlers

## Methods

Named the same as HTTP requests/responses or smth

- get
- post
- delete
- smth else

There's also before & after handlers...whatever those are. You can limit them to only run some of the time, e.g. `before("/protected/*", context -> {...})` will limit the handler to only run on requests from `/protected/`. 

Most of the functionality, Ken says, is in the end-point handlers.

## Javalin Exceptions

Javalin has exceptions you can throw in Java that correlate to HTTP errors, e.g. `NotFoundException` correlates to "404 Not Found" HTTP error.

## Named parameters

### Passing parameters in through the URL

Most of the time we're going to pass JSON strings in through the request body. Another place you can pass parameters in is through the request URL.

```java
// <...> allows slashes, {...} does not allow slashes

// matches "GET /hello/foo" and "GET /hello/bar"
get("/hello/{name}", context -> {
    return "Hello: " + context.pathParam("name");
})

// matches "GET /hello/foo/bar"
get("/hello/<name>", context -> {
    return "Hello: " + context.pathParam("name");
})
```

## Wildard Parameters

```java
// matches "GET /hello/foo/bar"
get ("/hello/*", context -> {
    // url part matching * not available
    // use <...> syntax to access
})
```

## Useful Request & Response methods

### Request

- `body`
- `headerMap`
- `header("...")`
- `path`

### Response

- `result("Hello")` - sets the response body to the inputted string. But does not set content type for you. (Typically when you return data from a function you want to set the content type to tell the caller what data they're getting)
- `json("{message:Hello}")`
- `header("...", "...")` - sets a header
- `contentType("...")` - sets the content type.
    - Just a headewr? So only there for convenience? idk.
- `status(404)` - sets status to 404 (not found)

## Error handling

One of the harder parts about writing your server.

Are you going to throw exceptions? Or are you going to pass errors through another way, e.g. status codes?

### Handling exceptions w/ Javalin

Javalin has an exception method for installing a global exception handler in your server. That's really useful. It serves as a last resort handler that catches exceptions your server code didn't.

```java
app.exception(Exception.class, (e, ctx) -> {
    // handle general exceptions here
    // will not trigger if more specific exception-mapper found
});
```

That one catches *any* exceptions (`Exception.class`).

### Handling status codes w/ Javalin

Javalin has a method that handles HTTP status codes (though it calls them "errors") on a global level. This is also useful.

```
app.error(404, ctx -> {
    ctx.result("Generic 404 message");
});
```


# Serving Static Files

> One of the first thing you should do when starting this part of the project is getting your test page working, Roddy said. 

## Web applications

```java
import io.javalin.Javalin;

public class StaticFileServer {
    ...

    public int run(int requestedPort) {
        Javalin javalinServer = Javalin.create(
            config -> config.staticFiles.add("web")
        );

        ...
        
    }

    ...
}
```

## Talking to Intellij

Here's something to check if Javalin can't find your website files.

You can create a **resources folder** in Intellij. 

Your "resources" folder in your files may not be already marked as a resources folder in Intellij. You have to right-click it and mark it as a "resources root" in Intellij.


# Putting Javalin in your project

To put Javalin in your Intellij project, you have to make add a dependency for it in your Intellij project...but Roddy's p sure they already did that in the Chess repo so you shouldn't have to.

If you have to, though, you can find dependences here:

Project structure > Modules > Dependencies

# So what does a handler actually *do*???

It gets the HTTP request, unpacks it, and calls the service class and stuff.

# Tips

## How to avoid code duplication

- Areas of potential code dupe
    - HTTP handler classes
    - Service classes
    - Request/result classes
    - DAO classes

Use inheritance to avoid this kind of code duplication. (Put common code in base classes that can be inherited.)

Don't worry, they don't look to scrutinously at your code duplication. But they will dock you if it's aggregious.

## Json tips

- Make sure that the field (variable) names in your Request & Response classes match exactly the names used in the specification (including capitalization).
    - Not doing this will cause bugs.
- GSON does not serialize null fields (they will be missing in the JSON).
    - Roddy said smth ab how you can use this to make your JSON objects look different than what the autograder or whatever is expecting. If you just set stuff to null, then it won't get serialized when passed to the autograder or whatever tf he was talking ab.
- This is helpful when generating Success and Failure JSON responses.


```java
class Response {
    string message;
}

class LoginResponse extends Response {
    String authtoken;
    String username;
}
```

# Generating an Auth Token

Here's a simple way:

`UUID.randomUUID().toString()`

"UUID" == "Universally Unique Identifier". It's a Java class that can generate (almost) completely unique strings.

# Server implementation approach

- Review class structure diagram.
- Create Java packages in your project to contain your server classes.
- Create your Server class and get static file handling to work so you can see the test page. (see the Server Web API lecture for details.)
- Pick one Web API and get it working end-to-end, and test it w/ the test Web page (e.g., login) or curl.
- As you go, write JUnit test cases for Service classes you create.
    - You have to write your own tests for for the project anyway.
    - We'll talk ab how to do testing next class.
- Repeat for the other Web APIs until you have written all 7 and are passing all of the passoff tests.